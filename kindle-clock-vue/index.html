<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>KindleClock</title>
  <!-- 全屏错误日志 -->
  <div id="error-log"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; color:black; z-index:99999; padding:20px; font-size:16px; word-break:break-all; overflow:auto;">
    <h3>Runtime Error:</h3>
    <pre id="error-content"></pre>
    <button onclick="document.getElementById('error-log').style.display='none'"
      style="border:2px solid black; padding:10px; margin-top:20px; font-size:20px;">关闭</button>
  </div>
  <script>
    window.onerror = function (message, source, lineno, colno, error) {
      var log = document.getElementById('error-log');
      var content = document.getElementById('error-content');
      log.style.display = 'block';
      content.textContent += 'Msg: ' + message + '\nLine: ' + lineno + '\nSrc: ' + source + '\n\n';
    };
  </script>
  <link rel="stylesheet" href="src/style.css">
</head>

<body>
  <div id="app-container" class="container">
    <!-- 遮罩层 (防残影) -->
    <div id="refresh-overlay" class="refresh-overlay hidden"></div>

    <!-- 设置入口 -->
    <div id="settings-trigger" class="settings-trigger" title="点击打开设置"></div>

    <!-- 内容区 -->
    <main id="content" class="content">
      <!-- 数字时钟 DOM -->
      <div id="digital-clock" class="digital-clock hidden">
        <div id="dc-time" class="dc-time">00:00</div>
        <div id="dc-date" class="dc-date">1月1日 周一</div>
      </div>

      <!-- 指针时钟 DOM -->
      <div id="analog-clock" class="analog-clock hidden">
        <svg viewBox="0 0 100 100" class="clock-svg">
          <!-- 关键修复：显式添加 fill="none" stroke="black"，因为老内核可能忽略 CSS -->
          <circle cx="50" cy="50" r="48" class="face" fill="none" stroke="black" stroke-width="2" />

          <!-- 刻度组 -->
          <g id="ac-ticks"></g>

          <!-- 指针 -->
          <line id="ac-hour" x1="50" y1="50" x2="50" y2="25" class="hand hour" stroke="black" stroke-width="4"
            stroke-linecap="round" />
          <line id="ac-minute" x1="50" y1="50" x2="50" y2="10" class="hand minute" stroke="black" stroke-width="2.5"
            stroke-linecap="round" />
          <circle cx="50" cy="50" r="2" class="center" fill="black" />
        </svg>
        <div id="ac-date" class="analog-date">1月1日</div>
      </div>
      <!-- 天气区域 (插入在主内容下方) -->
      <div id="weather-container" class="weather-container">
        <div id="weather-icon" class="iconfont"></div>
        <div>
          <div id="weather-current" class="w-temp">--°</div>
          <div id="weather-text" class="w-text">正在获取天气...</div>
          <div id="weather-range" class="w-range">-- ~ --°C</div>
        </div>
      </div>

      <!-- 60s 新闻 -->
      <div id="news-container" class="news-container">
        <div id="news-text">正在获取新闻...</div>
      </div>
    </main>

    <!-- 设置弹窗 -->
    <div id="settings-overlay" class="settings-overlay hidden">
      <div class="settings-dialog">
        <h2 class="settings-title">系统设置</h2>

        <div class="settings-group">
          <label>时钟样式</label>
          <div class="radio-group" id="opt-clock-type">
            <button data-val="digital">数字</button>
            <button data-val="analog">指针</button>
          </div>
        </div>

        <div class="settings-group">
          <label>屏幕旋转</label>
          <div class="radio-group" id="opt-rotation">
            <button data-val="0">0°</button>
            <button data-val="90">90°</button>
            <button data-val="180">180°</button>
            <button data-val="270">270°</button>
          </div>
        </div>

        <div class="settings-group">
          <button id="btn-force-refresh"
            style="width:100%; padding:1.5rem; font-size:1.5rem; background:white; color:black; border:2px solid black; margin-bottom:1rem; font-weight:bold;">强制刷新
            (清除缓存)</button>
        </div>

        <button id="btn-close-settings" class="close-btn">关闭</button>
      </div>
    </div>
  </div>

  <!-- 外部依赖: IP 定位 -->
  <script src="https://pv.sohu.com/cityjson"></script>

  <!-- 引入原生 JS 逻辑 -->
  <script src="src/clock-renderer.js"></script>
  <script src="src/weather.js"></script>
  <script src="src/news.js"></script>
  <script src="src/main.js"></script>
</body>

</html>